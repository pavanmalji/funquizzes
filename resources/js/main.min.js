var sessioncookie="sessioncooky";function cooky(a){return{provider:a,modifiedAt:Math.round((new Date()).getTime()/1000)}}function getSessionCookie(){var a=$.cookie(sessioncookie);if(a){return JSON.parse(a)}return null}function setSessionCookie(a){$.cookie(sessioncookie,JSON.stringify(a),{path:"/"})}function deleteSessionCookie(){$.cookie(sessioncookie,null,{path:"/"})}function getRandomBetween(b,a){return Math.floor(Math.random()*(a-b+1)+b)}var pages={home:["","resources/fragments/home.txt"],profile:["Profile Information","resources/fragments/profile.txt"],help:["Help","resources/fragments/help.txt"],comments:["Comments","resources/fragments/comments.txt"],dashboardallquizzes:["Dashboard - Select Quiz","resources/fragments/dashboardallquizzes.txt"],dashboardquizresults:["Dashboard - Results","resources/fragments/dashboardquizresults.txt"],playersection:["Player - Select/Join Quiz ","resources/fragments/playersection.txt"],playerplayquiz:["Player - Play Quiz","resources/fragments/playerplayquiz.txt"],playerresults:["Player - Results","resources/fragments/playerresults.txt"],quizmastersection:["Quiz Master - Section","resources/fragments/quizmastersection.txt"],quizmasteraddquestions:["Quiz Master - Add Questions","resources/fragments/quizmasteraddquestions.txt"],quizmastercreatequiz:["Quiz Master - Create Quiz","resources/fragments/quizmastercreatequiz.txt"]};var authURLS={gplus:{login:"",logout:""},fb:{login:"",logout:""}};var messageMap={home_start:["Welcome to Fun Quizzes.","alert alert-info"],login_success:["You have logged in successfully.","alert alert-success"],login_error:["There was an error during login. Please try again.","alert alert-danger"],logout_success:["Thank you. Hope to see you again.","alert alert-info"],warning:["Dummy Warning","alert alert-warning"],question_add_wait:["Adding Question. Please Wait.","alert alert-info"],question_add_success:["Question added successfully","alert alert-success"],question_add_error:["Error adding question.","alert alert-danger"],user_answers_save_error:["Error saving answer. Please try again.","alert alert-warning"],quiz_create_wait:["Creating quiz. Please Wait.","alert alert-info"],quiz_create_success:["Quiz created successfully","alert alert-success"],quiz_create_error:["Error creating quiz.","alert alert-danger"],quiz_update_wait:["Updating quiz. Please Wait.","alert alert-info"],quiz_update_success:["Quiz updated successfully","alert alert-success"],quiz_update_error:["Error updating quiz.","alert alert-danger"],quiz_join_wait:["Joining quiz. Please Wait.","alert alert-info"],quiz_join_error_pin_incorrect:["Error joining quiz. Pin Incorrect.","alert alert-danger"],quiz_join_error:["Error joining quiz. Please try again.","alert alert-danger"],user_comment_add_error:["Error adding comment. Please try again.","alert alert-danger"]};var message={showMessage:ko.observable(false),displayText:ko.observable(""),displayStyle:ko.observable("")};function quiz(){return{name:ko.observable(),description:ko.observable(),questionids:ko.observableArray([])}}function quizAnswerChoice(a){return{choice:a,removeChoice:function(){viewModel.crudQuizQuestionAnswer().choices.remove(this)}}}function quizQuestionAnswer(c,b,a,d,e){return{_id:ko.observable(c),tags:ko.observable(b),question:ko.observable(a),answer:ko.observable(d),choices:ko.observableArray([new quizAnswerChoice(""),new quizAnswerChoice("")]),addChoice:function(){viewModel.crudQuizQuestionAnswer().choices.push(new quizAnswerChoice(""))}}}var viewModel={_dummyObservable:ko.observable(),sessionUser:ko.observable([]),currentPageURL:ko.observable("home"),currentPageTitle:ko.observable("Fun Quizzes"),currentPageMessage:ko.observable(message),quizQuestionsAnswers:ko.observableArray([]),hasMoreQuestionsAnswers:ko.observable(true),crudQuizQuestionAnswer:ko.observable(new quizQuestionAnswer("Will be generated.")),addQuestionAnswer:function(){viewModel.currentPageMessage().showMessage(true);viewModel.currentPageMessage().displayText(messageMap.question_add_wait[0]);viewModel.currentPageMessage().displayStyle(messageMap.question_add_wait[1]);var b=[];$.each(viewModel.crudQuizQuestionAnswer().choices(),function(c,d){b.push(d.choice)});var a={addquestionanswer:true,questionAnswer:{tags:viewModel.crudQuizQuestionAnswer().tags(),question:viewModel.crudQuizQuestionAnswer().question(),answer:viewModel.crudQuizQuestionAnswer().answer(),choices:b}};$.post("utils/quizinfo.php",a,function(d,c){if(d._id!==undefined){viewModel.currentPageMessage().displayText(messageMap.question_add_success[0]);viewModel.currentPageMessage().displayStyle(messageMap.question_add_success[1])}else{viewModel.currentPageMessage().displayText(messageMap.question_add_error[0]);viewModel.currentPageMessage().displayStyle(messageMap.question_add_error[1])}})},crudQuiz:ko.observable(new quiz()),createQuiz:function(){viewModel.currentPageMessage().showMessage(true);viewModel.currentPageMessage().displayText(messageMap.quiz_create_wait[0]);viewModel.currentPageMessage().displayStyle(messageMap.quiz_create_wait[1]);var b=[];$.each(viewModel.crudQuiz().questionids(),function(c,d){b.push(d)});var a={createquiz:true,quiz:{name:viewModel.crudQuiz().name(),description:viewModel.crudQuiz().description(),questionids:b}};$.post("utils/quizinfo.php",a,function(d,c){if(d._id!==undefined){viewModel.currentPageMessage().displayText(messageMap.quiz_create_success[0]);viewModel.currentPageMessage().displayStyle(messageMap.quiz_create_success[1])}else{viewModel.currentPageMessage().displayText(messageMap.quiz_create_error[0]);viewModel.currentPageMessage().displayStyle(messageMap.quiz_create_error[1])}})},allquizzes:ko.observableArray([]),hasMoreQuizzes:ko.observable(true),activeQuizzes:ko.observableArray([]),hasMoreActiveQuizzes:ko.observable(true),createdQuizzes:ko.observableArray([]),hasMoreCreatedQuizzes:ko.observable(true),selectedQuiz:ko.observable([]),quizData:ko.observable([]),currentQuestionAnswer:ko.observable([]),quizUserData:ko.observable([]),quizUsers:ko.observable([]),showQuizResults:function(b,a){viewModel.selectedQuiz(b);viewModel.currentPageURL("dashboardquizresults")},updateQuiz:function(c,b){viewModel.currentPageMessage().showMessage(true);viewModel.currentPageMessage().displayText(messageMap.quiz_update_wait[0]);viewModel.currentPageMessage().displayStyle(messageMap.quiz_update_wait[1]);c.pin=$("#"+c._id).val();var a={updatequiz:true,quiz:c};$.post("utils/quizinfo.php",a,function(e,d){if(e!==undefined){viewModel.currentPageMessage().displayText(messageMap.quiz_update_success[0]);viewModel.currentPageMessage().displayStyle(messageMap.quiz_update_success[1])}else{viewModel.currentPageMessage().displayText(messageMap.quiz_update_error[0]);viewModel.currentPageMessage().displayStyle(messageMap.quiz_update_error[1])}})},joinQuiz:function(c,b){viewModel.currentPageMessage().showMessage(true);viewModel.currentPageMessage().displayText(messageMap.quiz_join_wait[0]);viewModel.currentPageMessage().displayStyle(messageMap.quiz_join_wait[1]);if(c.pin!==$("#"+c._id).val()){viewModel.currentPageMessage().displayText(messageMap.quiz_join_error_pin_incorrect[0]);viewModel.currentPageMessage().displayStyle(messageMap.quiz_join_error_pin_incorrect[1])}else{viewModel.selectedQuiz(c);var a={joinquiz:true,quiz:viewModel.selectedQuiz()};$.post("utils/quizinfo.php",a,function(f,e){if(f!==undefined&&f.length>0){var d=f[0];d.userAnswers=[];d.correct=0;d.wrong=0;d.total=f[1].length;viewModel.quizUserData(d);viewModel.quizData(f[1].sort(function(){return 0.5-Math.random()}));viewModel.currentQuestionAnswer(viewModel.quizData()[0]);viewModel.currentPageURL("playerplayquiz")}else{viewModel.currentPageMessage().displayText(messageMap.quiz_join_error[0]);viewModel.currentPageMessage().displayStyle(messageMap.quiz_join_error[1])}})}},userAnswer:function(c,b){viewModel.currentPageMessage().showMessage(false);var d={questionId:viewModel.currentQuestionAnswer()._id,answer:c,isCorrect:(c===viewModel.currentQuestionAnswer().answer)};$("#choices .btn").addClass("disabled");$("#main-panel").removeClass("panel-default");$("#main-panel").addClass(d.isCorrect?"panel-success":"panel-danger");viewModel.quizUserData().userAnswers.push(d);viewModel.quizUserData().correct=viewModel.quizUserData().correct+(d.isCorrect?1:0);viewModel.quizUserData().wrong=viewModel.quizUserData().wrong+(d.isCorrect?0:1);$("#correct").html(viewModel.quizUserData().correct);$("#wrong").html(viewModel.quizUserData().wrong);$("#remaining").html(viewModel.quizUserData().total-(viewModel.quizUserData().correct+viewModel.quizUserData().wrong));var a={saveuseranswer:true,quizUserData:viewModel.quizUserData()};$.post("utils/quizinfo.php",a,function(g,f){if(g!==undefined){var e=viewModel.quizUserData().userAnswers.length;if(e<viewModel.quizData().length){viewModel.currentQuestionAnswer(viewModel.quizData()[e])}else{viewModel.currentQuestionAnswer(null);viewModel._dummyObservable("Dummy to force computed value refresh.")}}else{viewModel.quizUserData().userAnswers.pop();viewModel.currentPageMessage().showMessage(true);viewModel.currentPageMessage().displayText(messageMap.user_answers_save_error[0]);viewModel.currentPageMessage().displayStyle(messageMap.user_answers_save_error[1])}}).fail(function(){viewModel.quizUserData().userAnswers.pop();viewModel.currentPageMessage().showMessage(true);viewModel.currentPageMessage().displayText(messageMap.user_answers_save_error[0]);viewModel.currentPageMessage().displayStyle(messageMap.user_answers_save_error[1])}).always(function(){$("#choices .btn").removeClass("disabled");$("#main-panel").removeClass(d.isCorrect?"panel-success":"panel-danger");$("#main-panel").addClass("panel-default")})},choicesAfterRender:function(){$("#choices").hide();$("#choices").slideDown(200)},crudComment:ko.observable(),usersComments:ko.observableArray([]),hasMoreComments:ko.observable(true),addComment:function(){viewModel.currentPageMessage().showMessage(false);var a={addcomment:true,comment:viewModel.crudComment()};$.post("utils/quizinfo.php",a,function(d,b){if(d._id!==undefined){var c={_id:d._id,comment:viewModel.crudComment(),userId:viewModel.sessionUser()._id,userInfo:{name:viewModel.sessionUser().name,picture:viewModel.sessionUser().picture,link:viewModel.sessionUser().link},_createdAt:d._createdAt,_updatedAt:d._createdAt};viewModel.usersComments.unshift(c);viewModel.crudComment("")}else{viewModel.currentPageMessage().showMessage(true);viewModel.currentPageMessage().displayText(messageMap.user_comment_add_error[0]);viewModel.currentPageMessage().displayStyle(messageMap.user_comment_add_error[1])}})}};viewModel.currentPageURL().loadPage=ko.dependentObservable(function(){viewModel.currentPageMessage().showMessage(false);$.get(pages[viewModel.currentPageURL()][1]+"?_="+(new Date().getTime()),function(a){$("#page-content").hide().html(a).fadeIn(300);var b=$("#page-content")[0];ko.cleanNode(b);ko.applyBindings(viewModel,b);postPageLoad();if(viewModel.sessionUser().length===0||viewModel.sessionUser()._id==="000000000000000000000000"){$.get("utils/authinfo.php?user",function(c){if(c!==undefined){viewModel.sessionUser(c);setSessionCookie(new cooky(viewModel.sessionUser().provider))}})}})},viewModel);viewModel.quizResult=ko.computed(function(){var e=this.quizData().length;var d=0;var b=0;var a=0;var c=viewModel._dummyObservable();if(this.quizUserData().userAnswers!==undefined){$.each(this.quizUserData().userAnswers,function(f,g){if(g.isCorrect===true){d++}else{b++}})}a=e-(d+b);return{total:e,correct:d,wrong:b,notanswered:a}},viewModel);viewModel.crudCommentLength=ko.computed(function(){var a=viewModel.crudComment();return(a===undefined)?0:(a.trim()).length},viewModel);$(document).on("click",".navbar a.navbar-link",function(b){var a=$(".navbar-toggle");if(a.is(":visible")){a.trigger("click")}b.preventDefault();viewModel.currentPageMessage().showMessage(false);viewModel.currentPageURL($(this).attr("href"))});$(document).on("click",".page-link",function(a){a.preventDefault();viewModel.currentPageMessage().showMessage(false);viewModel.currentPageURL($(this).attr("href"))});$(document).on("click",".login",function(b){b.preventDefault();var a=$(this).attr("href");window.location=authURLS[a].login});$(document).on("click",".logout",function(b){b.preventDefault();var a=viewModel.sessionUser().provider;deleteSessionCookie();window.location=authURLS[a].logout});function getQuizUsersByHighScore(){getQuizUsers("&sort=-correct")}function getQuizUsersByLowScore(){getQuizUsers("&sort=-wrong")}function getQuizUsers(a){if(a===undefined){a="&sort=-_updatedAt"}$.get("utils/quizinfo.php?quizusers&quizid="+viewModel.selectedQuiz()._id+a,function(b){if(b!==undefined&&b.length>0){viewModel.quizUsers(b)}else{}})}function getAllQuizzes(){var a=5;var b=viewModel.allquizzes().length;$.get("utils/quizinfo.php?allquizzes&limit="+a+"&skip="+b,function(c){if(c!==undefined&&c.length>0){viewModel.allquizzes(viewModel.allquizzes().concat(c));viewModel.hasMoreQuizzes(c.length===a)}else{viewModel.hasMoreQuizzes(false)}})}function getActiveQuizzes(){var a=5;var b=viewModel.activeQuizzes().length;$.get("utils/quizinfo.php?activequizzes&limit="+a+"&skip="+b,function(c){if(c!==undefined&&c.length>0){viewModel.activeQuizzes(viewModel.activeQuizzes().concat(c));viewModel.hasMoreActiveQuizzes(c.length===a)}else{viewModel.hasMoreActiveQuizzes(false)}})}function getCreatedQuizzes(){var a=5;var b=viewModel.createdQuizzes().length;$.get("utils/quizinfo.php?createdquizzes&limit="+a+"&skip="+b,function(c){if(c!==undefined&&c.length>0){viewModel.createdQuizzes(viewModel.createdQuizzes().concat(c));viewModel.hasMoreCreatedQuizzes(c.length===a)}else{viewModel.hasMoreCreatedQuizzes(false)}})}function getQuestionsAnswers(){var a=5;var b=viewModel.quizQuestionsAnswers().length;$.get("utils/quizinfo.php?questionsanswers&limit="+a+"&skip="+b,function(c){if(c!==undefined&&c.length>0){viewModel.quizQuestionsAnswers(viewModel.quizQuestionsAnswers().concat(c));viewModel.hasMoreQuestionsAnswers(c.length===a)}else{viewModel.hasMoreQuestionsAnswers(false)}})}function getComments(){var a=5;var b=viewModel.usersComments().length;$.get("utils/quizinfo.php?comments&limit="+a+"&skip="+b,function(c){if(c!==undefined&&c.length>0){viewModel.usersComments(viewModel.usersComments().concat(c));viewModel.hasMoreComments(c.length===a)}else{viewModel.hasMoreComments(false)}})}function postPageLoad(){if(!isSessionAlive()&&!isAnonymousSession()){var a=getSessionCookie().provider;deleteSessionCookie();if(authURLS[a].logout!==""){window.location=authURLS[a].logout}}viewModel.currentPageTitle(pages[viewModel.currentPageURL()][0]);switch(viewModel.currentPageURL()){case"dashboardallquizzes":viewModel.allquizzes([]);getAllQuizzes();break;case"dashboardquizresults":viewModel.currentPageTitle(viewModel.currentPageTitle()+" - "+viewModel.selectedQuiz().name);getQuizUsers();break;case"playersection":viewModel.activeQuizzes([]);getActiveQuizzes();break;case"playerplayquiz":viewModel.currentPageTitle(viewModel.currentPageTitle()+" - "+viewModel.selectedQuiz().name);$("#correct").html(viewModel.quizUserData().correct);$("#wrong").html(viewModel.quizUserData().wrong);$("#remaining").html(viewModel.quizUserData().total-(viewModel.quizUserData().correct+viewModel.quizUserData().wrong));break;case"quizmastersection":viewModel.createdQuizzes([]);getCreatedQuizzes();break;case"quizmastercreatequiz":viewModel.quizQuestionsAnswers([]);getQuestionsAnswers();break;case"comments":viewModel.usersComments([]);getComments();break}}function initAuthURLS(){for(var a in authURLS){$.get("utils/authinfo.php?"+a+"&authurls",function(b){if(b!==undefined){authURLS[b.provider].login=b.login;authURLS[b.provider].logout=b.logout}})}}function isSessionAlive(){var c=getSessionCookie();var b=1800;var a=Math.round((new Date()).getTime()/1000);if(Math.abs(a-c.modifiedAt)<b){return true}return false}function isAnonymousSession(){if(getSessionCookie().provider==="none"){return true}else{return false}}function initSessionCookie(){var a=getSessionCookie();if(a===null){setSessionCookie(new cooky("none"))}}function facebookLoginRedirectURIBugFix(){if(window.location.hash==="#_=_"){window.location.hash="";history.pushState("",document.title,window.location.pathname);event.preventDefault()}}function initApp(){initSessionCookie();initAuthURLS();ko.applyBindings(viewModel);facebookLoginRedirectURIBugFix()};